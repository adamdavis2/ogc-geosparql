= Annex D - Usage of SHACL shapes (informative)

== D.0 Overview

This Annex provides guidance on the usage of the SHACL shapes shipped with the GeoSPARQL specification. 

== D.1 Foundations

https://github.com/opengeospatial/ogc-geosparql/blob/master/1.1/validator.ttl[SHACL shapes provided with GeoSPARQL] are used to verify the graph structure of GeoSPARQL graphs. 
There are several SHACL verification tools that one might consider using to validate their graph.

https://github.com/RDFLib/pySHACL[PySHACL] is a python implementation based on RDFlib which is able to validate graphs.

https://jena.apache.org/documentation/shacl/index.html[Apache Jena SHACL] might be used to validate graphs as well.

The previous implementations require to load the SHACL shape set of GeoSPARQL and the graph to be tested. A test result will be generated which describes the success or failure of predefined tests encoded in the GeoSPARQL SHACL shapes.

In addition, SHACL is part of many triple store implementations such as GraphDB, RDF4J and Apache Jena Fuseki, which may also be used for graph verification.

The following sections elaborate on the kind of shapes and their purposes.

== D.2 Scope of SHACL shapes provided with GeoSPARQL

== D.3 Table of SHACL shapes

[cols="1,1,1,1"]
|===
|SHACL Shape ID | Severity | Test purpose | Requirements tested 

|Shape 1a
| Violation
| Each node with an incoming http://www.opengis.net/ont/geosparql#hasGeometry[geo:hasGeometry], or a specialization of it, should have minimum one outgoing relation that is either http://www.opengis.net/ont/geosparql#hasSerialization[geo:hasSerialization], or a specialization of it.
| <<req_core_sparql-protocol>> <<Req 7, `Requirement 7`>>

|Shape 1b
| Warning
| Tests for many serializations attached to one instances of http://www.opengis.net/ont/geosparql#Geometry[geo:Geometry]. It is recommended, that only one serialization is attached to a Geometry. If not, the user should ensure, that the serializations are equivalent.
| <<Req 13, `Requirement 13`>>

|Shape 1c
| Violation
| Each node with an incoming http://www.opengis.net/ont/geosparql#hasGeometry[geo:hasGeometry], or a specialization of it, can have a maximum of one outgoing http://www.opengis.net/ont/geosparql#asWKT[geo:asWKT] relation.
| 

|Shape 1d
| Violation
| Each node with an incoming http://www.opengis.net/ont/geosparql#hasGeometry[geo:hasGeometry], or a specialization of it, can have a maximum of one outgoing http://www.opengis.net/ont/geosparql#asGML[geo:asGML] relation.
| 

|Shape 1e
| Violation 
| Each node with an incoming http://www.opengis.net/ont/geosparql#hasGeometry[geo:hasGeometry], or a specialization of it, can have a maximum of one outgoing  http://www.opengis.net/ont/geosparql#asGeoJSON[geo:asGeoJSON]  relation.
| 

|Shape 1f
| Violation
| Each node with an incoming http://www.opengis.net/ont/geosparql#hasGeometry[geo:hasGeometry], or a specialization of it, can have a maximum of one outgoing http://www.opengis.net/ont/geosparql#asKML[geo:asKML] relation.
| 

|Shape 2
| Violation
| Each node with one or more outgoing relations that are either http://www.opengis.net/ont/geosparql#hasSerialization[geo:hasSerialization], or a specialization of it, should have at least one incoming http://www.opengis.net/ont/geosparql#hasGeometry[geo:hasGeometry] relation or a specialization of it.
| 

|Shape 3a-c
| Violation
| A node that has an incoming http://www.opengis.net/ont/geosparql#hasGeometry[geo:hasGeometry] property, or specialization of it, cannot have an outgoing http://www.opengis.net/ont/geosparql#hasGeometry[geo:hasGeometry] property, or a specialization of, it at the same time (a http://www.opengis.net/ont/geosparql#Feature[geo:Feature] cannot be a http://www.opengis.net/ont/geosparql#Geometry[geo:Geometry] at the same time)
| 

|Shape 4
| Violation
| The target of a http://www.opengis.net/ont/geosparql#hasSerialization[geo:hasSerialization] property, or a specialization of, it should be an RDF literal
| 

|Shape 5
| Violation
| The target of a http://www.opengis.net/ont/geosparql#asWKT[geo:asWKT] property should be an RDF literal with datatype http://www.opengis.net/ont/geosparql#wktLiteral[geo:wktLiteral]
| 

|Shape 6
| Violation
| The target of a http://www.opengis.net/ont/geosparql#asGML[geo:asGML] property should be an RDF literal with datatype http://www.opengis.net/ont/geosparql#gmlLiteral[geo:gmlLiteral]
| 

|Shape 7
| The target of a http://www.opengis.net/ont/geosparql#asGeoJSON[geo:asGeoJSON] property should be an RDF literal with datatype http://www.opengis.net/ont/geosparql#geoJSONLiteral[geo:geoJSONLiteral]
| 
| 

|Shape 8
| The target of a http://www.opengis.net/ont/geosparql#asKML[geo:asKML] property should be an RDF literal with datatype http://www.opengis.net/ont/geosparql#kmlLiteral[geo:kmlLiteral]
| 
| 

|Shape 10
| A http://www.opengis.net/ont/geosparql#Geometry[geo:Geometry] node should have maximum of one outgoing http://www.opengis.net/ont/geosparql#coordinateDimension[geo:coordinateDimension] property
| 
| 

|Shape 11
| A http://www.opengis.net/ont/geosparql#Geometry[geo:Geometry] node should have maximum of one outgoing http://www.opengis.net/ont/geosparql#dimension[geo:dimension] property
| 
| 

|Shape 12
| A http://www.opengis.net/ont/geosparql#Geometry[geo:Geometry] node should have maximum of one outgoing http://www.opengis.net/ont/geosparql#isEmpty[geo:isEmpty] property
| 
| 

|Shape 13
| A http://www.opengis.net/ont/geosparql#Geometry[geo:Geometry] node should have a maximum one outgoing http://www.opengis.net/ont/geosparql#isSimple[geo:isSimple] property
| 
| 

|Shape 14
| A http://www.opengis.net/ont/geosparql#Geometry[geo:Geometry] node should have maximum of one outgoing http://www.opengis.net/ont/geosparql#spatialDimension[geo:spatialDimension] property
| 
| 

|Shape 15a
| A http://www.opengis.net/ont/geosparql#Geometry[geo:Geometry] node should have maximum of one outgoing http://www.opengis.net/ont/geosparql#hasSpatialResolution[geo:hasSpatialResolution] property
| 
| 

|Shape 15b
| A http://www.opengis.net/ont/geosparql#Geometry[geo:Geometry] node should have maximum of one outgoing http://www.opengis.net/ont/geosparql#hasSpatialAccuracy[geo:hasSpatialAccuracy] property
| 
| 

|Shape 15c
| A http://www.opengis.net/ont/geosparql#Geometry[geo:Geometry] node should have maximum of one outgoing http://www.opengis.net/ont/geosparql#hasMetricAccuracy[geo:hasMetricAccuracy] property
| 
| 

|Shape 15d
| A http://www.opengis.net/ont/geosparql#Geometry[geo:Geometry] node should have maximum of one outgoing http://www.opengis.net/ont/geosparql#hasMetricResolution[geo:hasMetricResolution] property
| 
| 

|Shape 16
| The content of an RDF literal with an incoming http://www.opengis.net/ont/geosparql#asWKT[geo:asWKT] relation must conform to a well-formed WKT string, as defined by its official specification (Simple Features Access)
| 
| 

|Shape 17
| The content of an RDF literal with an incoming http://www.opengis.net/ont/geosparql#asWKT[geo:asWKT] relation must conform to a well-formed WKT string, as defined by its official specification (Simple Features Access)
| 
| 

|Shape 18
| The content of an RDF literal with an incoming http://www.opengis.net/ont/geosparql#asGeoJSON[geo:asGeoJSON] relation must conform to a well-formed GeoJSON geometry string, as defined by its official specification
| 
| 

|Shape 19
| The content of an RDF literal with an incoming http://www.opengis.net/ont/geosparql#asKML[geo:asKML] relation must conform to a well-formed KML geometry XML string, as defined by its official specification
| 
| 

|Shape 21
| A geo:Feature node (inferred or asserted) should have at least one outgoing http://www.opengis.net/ont/geosparql#hasGeometry[geo:hasGeometry] relation, or a specialization of it
| 
| 

|Shape 30
| If both geo:dimension and http://www.opengis.net/ont/geosparql#coordinateDimension[geo:coordinateDimension] properties are asserted, the value of http://www.opengis.net/ont/geosparql#dimension[geo:dimension] should be less than or equal to the value of geo:coordinateDimension
| 
| 

|Shape 32
| A http://www.opengis.net/ont/geosparql#Geometry[geo:Geometry] node (inferred or asserted) should always have at least one incoming http://www.opengis.net/ont/geosparql#hasGeometry[geo:hasGeometry] relation, or a specialization of it
| 
| 

|Shape 33a
| An instance of http://www.opengis.net/ont/geosparql#FeatureCollection[geo:FeatureCollection] should have at least one outgoing http://www.w3.org/2000/01/rdf-schema#member[rdfs:member] relation
| 
| 

|Shape 33b
| An instance of http://www.opengis.net/ont/geosparql#FeatureCollection[geo:FeatureCollection] should only have outgoing http://www.w3.org/2000/01/rdf-schema#member[rdfs:member] going to geo:Feature instances
| 
| 

|Shape 34a
| An instance of http://www.opengis.net/ont/geosparql#GeometryCollection[geo:GeometryCollection] should have at least one outgoing http://www.w3.org/2000/01/rdf-schema#member[rdfs:member] relation
| 
| 

|Shape 34b
| An instance of http://www.opengis.net/ont/geosparql#GeometryCollection[geo:GeometryCollection] should only have outgoing http://www.w3.org/2000/01/rdf-schema#member[rdfs:member] relations to http://www.opengis.net/ont/geosparql#Geometry[geo:Geometry] instances
| 
| 

|Shape 35a
| An instance of http://www.opengis.net/ont/geosparql#SpatialObjectCollection[geo:SpatialObjectCollection] should have at least one outgoing http://www.w3.org/2000/01/rdf-schema#member[rdfs:member] relation
| 
| 

|Shape 35b
| An instance of http://www.opengis.net/ont/geosparql#SpatialObjectCollection[geo:SpatialObjectCollection] should only have outgoing http://www.w3.org/2000/01/rdf-schema#member[rdfs:member] relations going to http://www.opengis.net/ont/geosparql#SpatialObject[geo:SpatialObject] instances, or subclasses of them
| 
| 

|===
